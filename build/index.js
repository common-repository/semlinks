!function(){"use strict";var t={n:function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,{a:n}),n},d:function(e,n){for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}},e=window.wp.apiFetch,n=t.n(e),r=[],o=null,i={getSettings:function(){return n()({path:"/semlinks-plugin/v1/settings",method:"GET"})},isApiKeyValid:function(){return null!==o?Promise.resolve(o):n()({path:"/semlinks-plugin/v1/settings",method:"GET"}).then((function(t){return o=t&&t.is_api_key_valid&&"true"===t.is_api_key_valid,r=t.allowed_features,i}))},isFeatureAllowed:function(t){return r.length>0?Promise.resolve(r.includes(t)):n()({path:"/semlinks-plugin/v1/settings",method:"GET"}).then((function(e){return(r=e.allowed_features).includes(t)}))}},__=wp.i18n.__,a=jQuery,c={bindEvents:function(){var t=document.querySelector("#semlinks-plugin-start-sync-button");t&&t.addEventListener("click",c.clickHandle),document.querySelector("#semlinks-plugin_sync_posts_progress")&&setInterval((function(){c.followSynchronization()}),1e4)},followSynchronization:function(){n()({path:"/semlinks-plugin/v1/related-posts/nb-already-synced",method:"GET"}).then((function(t){document.querySelector("#semlinks-plugin_sync_posts_progress").setAttribute("value",t.nbPostSynced);var e=document.querySelector("#semlinks-plugin_sync_posts_total").getAttribute("value"),n=document.querySelector("#semlinks-plugin_sync_tags_total").getAttribute("value");parseInt(e)+parseInt(n)===t.nbPostSynced+t.nbTagSynced&&c.markSyncAsDone()})).catch((function(t){console.error(t)}))},markSyncAsDone:function(){var t=__("Done","semlinks");a("#semlinks-plugin-start-sync-button").html(t).attr("disabled",!0).attr("style","background-color: #4CAF50 !important; color: white !important")},clickHandle:function(t){t.preventDefault(),n()({path:"/semlinks-plugin/v1/initial-sync/start-sync",method:"POST"}).then((function(t){if(!t.success)throw alert(__("An error occurred and the synchronization could not start","semlinks")),new Error("Response content : ".concat(t.data));return t.synchId})).then((function(){document.querySelector("#semlinks-plugin-sync-info").parentNode.removeChild(document.querySelector("#semlinks-plugin-sync-info"));var t=__("Loading...","semlinks");a("#semlinks-plugin-start-sync-button").html(t).attr("disabled",!0)})).catch((function(t){return console.error(t)}))}},l=c,u=window.wp.richText,s=window.wp.components,f=window.wp.element,d=window.wp.i18n,p=function(t){var e=t.isLoading,n=t.posts,r=t.value,o=t.onChange,i=t.setOpen,a=t.permalinks;return React.createElement("div",{className:"semlinks-plugin-modal-result-table-container"},React.createElement("table",{className:"wp-list-table widefat fixed pages sortable "},e&&React.createElement("tr",null,React.createElement("td",null,React.createElement(s.Spinner,null))),!e&&n.length>0?n.map((function(t){return React.createElement("tr",null,React.createElement("td",null,React.createElement("strong",null,t.post_title),React.createElement(s.Button,{className:"float-right",onClick:function(){return function(t){i(!1),o((0,u.toggleFormat)(r,{type:"semlinks-plugin/link-to-related-post",attributes:{href:a[t.ID]}}))}(t)},variant:"primary"},(0,d.__)("Select","semlinks"))))})):e?React.createElement(React.Fragment,null):React.createElement("tr",null,React.createElement("td",null,React.createElement("span",null,(0,d.__)("No result","semlinks"))))))},h=window.React,m=window.wp.data,y=function(t){return n()({path:"/semlinks-plugin/v1/related-posts",method:"POST",data:t})},v=function(t,e){return""!==t.attributes.content?t.attributes.content:e};function g(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,_x,i,a=[],_n=!0,c=!1;try{if(_x=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;_n=!1}else for(;!(_n=(r=_x.call(n)).done)&&(a.push(r.value),a.length!==e);_n=!0);}catch(t){c=!0,o=t}finally{try{if(!_n&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var w=function(t){var e=t.open,n=t.setOpen,r=t.value,o=t.onChange,i=t.selectedText,a=function(){return n(!1)},c=g((0,f.useState)(!0),2),l=c[0],u=c[1],b=g((0,f.useState)([]),2),w=b[0],E=b[1],_=g((0,f.useState)([]),2),S=_[0],k=_[1],O=(0,m.useSelect)((function(t){return t("core/block-editor").getSelectedBlock()}),[]);return(0,h.useEffect)((function(){if(e){var t=wp.data.select("core/editor").getCurrentPost(),r={postId:wp.data.select("core/editor").getCurrentPostId(),content:v(O,i),introduction:""!==t.excerpt?t.excerpt:t.title,title:t.title};if(function(t){var e=["title","content","introduction"].filter((function(e){return!t[e]||""===t[e]}));return!(e.length>0)||e}(r).length>0)return void n(!1);y(r).then((function(t){E(t.posts),k(t.permalinks),u(!1)})).catch((function(t){console.error(t),u(!1)}))}}),[e]),React.createElement(React.Fragment,null,e&&React.createElement(s.Modal,{className:"semlinks-plugin-related-posts-modal",title:(0,d.__)("Choose the related post","semlinks"),onRequestClose:a},React.createElement(p,{isLoading:l,posts:w,value:r,onChange:o,setOpen:n,permalinks:S}),React.createElement(s.Button,{className:"semlinks-plugin-related-posts-modal-button",variant:"secondary",onClick:a},(0,d.__)("Cancel","semlinks")),React.createElement(s.Button,{className:"semlinks-plugin-related-posts-modal-button",variant:"primary",onClick:a},(0,d.__)("Save","semlinks"))))},E=window.wp.blockEditor,_=function(t){return n()({path:"/semlinks-plugin/v1/capabilities/current-user",method:"GET"}).then((function(e){return Object.keys(e).includes(t)&&!0===e[t]}))},S=["value"];function k(){return k=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},k.apply(this,arguments)}function O(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,_x,i,a=[],_n=!0,c=!1;try{if(_x=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;_n=!1}else for(;!(_n=(r=_x.call(n)).done)&&(a.push(r.value),a.length!==e);_n=!0);}catch(t){c=!0,o=t}finally{try{if(!_n&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return x(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var R=function(t){var e=t.value,n=function(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}(t,S),r=O((0,f.useState)(!1),2),o=r[0],i=r[1],a=O((0,f.useState)(!1),2),c=a[0],l=a[1];(0,h.useEffect)((function(){_("semlinks_plugin.semantic_platform.similar_article.insert").then((function(t){l(t)}))}),[]);var p=(0,m.useSelect)((function(t){return t("core/block-editor").getSelectedBlock()}),[]);if(p&&"core/paragraph"!==p.name)return null;var y=(0,u.getTextContent)((0,u.slice)(e));return""===y?null:React.createElement(React.Fragment,null,!1===c&&null,!0===c&&React.createElement(React.Fragment,null,React.createElement(E.BlockControls,null,React.createElement(s.ToolbarGroup,null,React.createElement(s.ToolbarButton,{icon:"search",title:(0,d.__)("Create a link","semlinks"),onClick:function(){i(!0)}}))),React.createElement(w,k({open:o,setOpen:i,selectedBlock:p,selectedText:y,value:e},n))))},A=function(){(0,u.registerFormatType)("semlinks-plugin/link-to-related-post",{title:"CSP Related post",tagName:"a",className:"semlinks-plugin-related-post-link",edit:R})},j=window.wp.coreData,P=window.wp.url;function L(t){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(t)}function T(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function C(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?T(Object(n),!0).forEach((function(e){I(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function I(t,e,n){return(e=function(t){var e=function(t,e){if("object"!==L(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==L(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===L(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function N(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return F(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?F(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function F(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function G(){G=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,n){return t[e]=n}}function u(t,e,n,o){var i=e&&e.prototype instanceof d?e:d,a=Object.create(i.prototype),c=new O(o||[]);return r(a,"_invoke",{value:E(t,n,c)}),a}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function d(){}function p(){}function h(){}var m={};l(m,i,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(x([])));v&&v!==e&&n.call(v,i)&&(m=v);var g=h.prototype=d.prototype=Object.create(m);function b(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(r,i,a,c){var l=s(t[r],t,i);if("throw"!==l.type){var u=l.arg,f=u.value;return f&&"object"==L(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(f).then((function(t){u.value=t,a(u)}),(function(t){return o("throw",t,a,c)}))}c(l.arg)}var i;r(this,"_invoke",{value:function(t,n){function r(){return new e((function(e,r){o(t,n,e,r)}))}return i=i?i.then(r,r):r()}})}function E(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=_(a,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=s(t,e,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===f)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}function _(t,e){var n=e.method,r=t.iterator[n];if(void 0===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var o=s(r,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,f;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function x(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:R}}function R(){return{value:void 0,done:!0}}return p.prototype=h,r(g,"constructor",{value:h,configurable:!0}),r(h,"constructor",{value:p,configurable:!0}),p.displayName=l(h,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,l(t,c,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},b(w.prototype),l(w.prototype,a,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new w(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(g),l(g,c,"Generator"),l(g,i,(function(){return this})),l(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=x,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(c&&l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;k(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:x(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function B(t,e,n,r,o,i,a){try{var c=t[i](a),l=c.value}catch(t){return void n(t)}c.done?e(l):Promise.resolve(l).then(r,o)}var D,M,q={fetchNamedEntities:function(t){return n()({path:"/semlinks-plugin/v1/ner/extract",method:"POST",data:t})},fetchTagsForEntity:function(t){var e={page:1,per_page:10,context:"view",search:t.entity};return n()({path:(0,P.addQueryArgs)("/wp/v2/tags",e),method:"GET"})},getTagById:function(t){return n()({path:"/wp/v2/tags/".concat(t),method:"GET"})},createNewTagForEntity:(D=G().mark((function t(e){var r;return G().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n()({path:"/wp/v2/tags",method:"POST",data:{name:e.entity}});case 2:return r=t.sent,t.next=5,q.addTagToCSPDictionary(r.id,e.type);case 5:return t.abrupt("return",r);case 6:case"end":return t.stop()}}),t)})),M=function(){var t=this,e=arguments;return new Promise((function(n,r){var o=D.apply(t,e);function i(t){B(o,n,r,i,a,"next",t)}function a(t){B(o,n,r,i,a,"throw",t)}i(void 0)}))},function(_x){return M.apply(this,arguments)}),addTagToCSPDictionary:function(t,e){return n()({path:"/semlinks-plugin/v1/dictionary/add-entity",method:"POST",data:{tagId:t,entityType:e}})},getToInsert:function(t){var e='<a href="'.concat(t.url,'" class="semlinks-plugin">').concat(t.entity,"</a>");return{toInsert:e,addedLength:e.length-t.entity.length}},insertEntityLink:function(t,e,n){var r=q.getToInsert(t),o=r.toInsert,i=r.addedLength;e=e.substring(0,t.start_char+1)+o+e.substring(t.end_char+1);var a,c=[],l=N(n);try{for(l.s();!(a=l.n()).done;){var u=a.value;u.start_char>t.start_char&&(u.start_char+=i,u.end_char+=i),u.start_char===t.start_char&&u.end_char===t.end_char&&(u.selected=!0),c.push(u)}}catch(t){l.e(t)}finally{l.f()}return{postContent:e,updatedEntities:q.orderEntities(c)}},orderEntities:function(t){return t.sort((function(t,e){var n=parseFloat(t.score.split("%")[0]);return parseFloat(e.score.split("%")[0])-n})),t},checkAndAdaptEntityPosition:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,r=q.getToInsert(t),o=r.addedLength;n+=o;var i=e.substring(t.start_char+1,t.end_char+1),a=i===t.entity;if(a)return{start_char:t.start_char,end_char:t.end_char};var c=q.getEntitySurroundings(t,e,n),l=c.indexOf(t.entity);if(-1===l){var u=q.decodeEntities(t.entity),s=c.indexOf(u);if(-1===s)return console.log("Entity not found in the surroundings"),null;t.entity=u}var f=t.start_char-(n+1)+l,d=f+t.entity.length;return{start_char:f,end_char:d}},getEntitySurroundings:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15;return e.substring(t.start_char-n,t.end_char+n)},isEntityLinked:function(t,e){var n=q.getEntitySurroundings(t,e,100).match(/(?<=<a href=".*?">)(.*?)(?=<\/a>)/g);if(null!==n&&n.length>0){var r,o=N(n);try{for(o.s();!(r=o.n()).done;)if(r.value===t.entity)return!0}catch(t){o.e(t)}finally{o.f()}}return!1},filterNotFoundEntitiesAndUpdatePositions:function(t,e){var n,r=[],o=N(t);try{for(o.s();!(n=o.n()).done;){var i=n.value,a=q.checkAndAdaptEntityPosition(i,e,50);i.selected=q.isEntityLinked(i,e),null!==a&&r.push(C(C({},i),a))}}catch(t){o.e(t)}finally{o.f()}return r},groupEntities:function(t){var e={};return t.forEach((function(t){void 0===e[t.type]&&(e[t.type]=[]),e[t.type].push(t)})),Object.keys(e).sort().reduce((function(t,n){return t[n]=e[n],t}),{})},getEntities:function(t){var e=t.named_entities;return null==e||""===e?[]:JSON.parse(e)},saveEntities:function(t,e,n){n(C(C({},e),{},{named_entities:JSON.stringify(q.orderEntities(t))}))},saveOneEntity:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;null===r&&(r=q.getEntities(e));var o,i=[],a=N(r);try{for(a.s();!(o=a.n()).done;){var c=o.value;c.start_char===t.start_char&&c.end_char===t.end_char&&(c=t),i.push(c)}}catch(t){a.e(t)}finally{a.f()}q.saveEntities(i,e,n)},syncEntitiesWithPostContent:function(t,e){if(0===t.length)return{updatedEntities:[],warning:!1};var n=[],r=[];t.forEach((function(t){var o=q.isEntityLinked(t,e),i=C(C({},t),{},{selected:o,selectedTag:o}),a=q.checkAndAdaptEntityPosition(t,e,80);null===a&&r.push(t),a&&(i=C(C({},i),a)),n.push(i)}));var o=r.length>=t.length/2;return{updatedEntities:n,warning:o}},decodeEntities:function(t){var e=document.createElement("div");return t&&"string"==typeof t&&(t=(t=t.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,"")).replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,""),e.innerHTML=t,t=e.textContent,e.textContent=""),t}};function U(t){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U(t)}function K(){K=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,n){return t[e]=n}}function u(t,e,n,o){var i=e&&e.prototype instanceof d?e:d,a=Object.create(i.prototype),c=new O(o||[]);return r(a,"_invoke",{value:E(t,n,c)}),a}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function d(){}function p(){}function h(){}var m={};l(m,i,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(x([])));v&&v!==e&&n.call(v,i)&&(m=v);var g=h.prototype=d.prototype=Object.create(m);function b(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(r,i,a,c){var l=s(t[r],t,i);if("throw"!==l.type){var u=l.arg,f=u.value;return f&&"object"==U(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(f).then((function(t){u.value=t,a(u)}),(function(t){return o("throw",t,a,c)}))}c(l.arg)}var i;r(this,"_invoke",{value:function(t,n){function r(){return new e((function(e,r){o(t,n,e,r)}))}return i=i?i.then(r,r):r()}})}function E(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=_(a,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=s(t,e,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===f)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}function _(t,e){var n=e.method,r=t.iterator[n];if(void 0===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var o=s(r,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,f;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function x(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:R}}function R(){return{value:void 0,done:!0}}return p.prototype=h,r(g,"constructor",{value:h,configurable:!0}),r(h,"constructor",{value:p,configurable:!0}),p.displayName=l(h,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,l(t,c,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},b(w.prototype),l(w.prototype,a,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new w(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(g),l(g,c,"Generator"),l(g,i,(function(){return this})),l(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=x,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(c&&l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;k(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:x(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function $(t,e,n,r,o,i,a){try{var c=t[i](a),l=c.value}catch(t){return void n(t)}c.done?e(l):Promise.resolve(l).then(r,o)}function H(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){$(i,r,o,a,c,"next",t)}function c(t){$(i,r,o,a,c,"throw",t)}a(void 0)}))}}function Y(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,_x,i,a=[],_n=!0,c=!1;try{if(_x=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;_n=!1}else for(;!(_n=(r=_x.call(n)).done)&&(a.push(r.value),a.length!==e);_n=!0);}catch(t){c=!0,o=t}finally{try{if(!_n&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return z(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var V=function(t){var e=t.entity,n=t.withType,r=void 0!==n&&n,o=t.withAction,i=void 0===o||o,a=Y((0,f.useState)(e.is_candidate?"candidate":"created"),2),c=a[0],l=a[1],u=Y((0,f.useState)(!1),2),p=u[0],h=u[1],m=function(){var t=H(K().mark((function t(e){return K().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return h(!0),e.entity=q.decodeEntities(e.entity),t.next=4,q.createNewTagForEntity(e).catch(function(){var t=H(K().mark((function t(n){return K().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(h(!1),!n.code||"term_exists"!==n.code){t.next=7;break}return t.next=4,q.addTagToCSPDictionary(n.data.term_id,e.type);case 4:return t.next=6,q.getTagById(n.data.term_id);case 6:return t.abrupt("return",t.sent);case 7:console.error(n);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).then((function(){l("created"),h(!1)}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return React.createElement("tr",null,React.createElement("td",null,q.decodeEntities(e.entity)),r&&React.createElement("td",null,(0,d.__)(e.type,"semlinks")),React.createElement("td",null,e.score),React.createElement("td",null,e.count),i&&React.createElement("td",null,p&&React.createElement("td",null,React.createElement("span",{className:"spinner semlinks-plugin-spinner"})),!p&&"candidate"===c&&React.createElement(s.Button,{onClick:function(){return m(e)},icon:React.createElement(s.Icon,{icon:"tag"}),label:(0,d.__)("Add as tag","semlinks"),isSmall:!0,isPrimary:!0,disabled:e.selectedTag}),"created"===c&&React.createElement(s.Icon,{sx:{color:"green"},icon:"yes-alt"})))},J=function(t){var e=t.entities,n=t.withType,r=void 0!==n&&n,o=t.withAction,i=void 0===o||o;return React.createElement("table",{className:"wp-list-table widefat fixed pages sortable "},React.createElement("thead",null,React.createElement("tr",null,React.createElement("td",{style:{width:"120px"}},(0,d.__)("Entity","semlinks")),r&&React.createElement("td",{style:{width:"120px"}},(0,d.__)("Type","semlinks")),React.createElement("td",{style:{width:"50px"}},(0,d.__)("Score","semlinks")),React.createElement("td",{style:{width:"50px"}},(0,d.__)("Number of occurrences","semlinks")),i&&React.createElement("td",{style:{width:"60px"}},(0,d.__)("Actions","semlinks")))),React.createElement("tbody",null,e.map((function(t){return React.createElement(V,{entity:t,withType:r,withAction:i})}))))},Q=window.wp.editor,W=function(t){var e=t.isLoading,n=t.posts,r=t.setPosts;return React.createElement("div",{className:"semlinks-plugin-modal-result-table-container"},React.createElement("table",{className:"wp-list-table widefat fixed pages sortable "},e&&React.createElement("tr",null,React.createElement("td",null,React.createElement(s.Spinner,null))),!e&&n.length>0?n.map((function(t){return React.createElement("tr",null,React.createElement("td",null,React.createElement("strong",null,t.post_title),React.createElement(s.Button,{className:"float-right",onClick:function(){return e=t.ID,void r(n.filter((function(t){return t.ID!==e})));var e},variant:"primary"},(0,d.__)("Delete","semlinks"))))})):e?React.createElement(React.Fragment,null):React.createElement("tr",null,React.createElement("td",null,React.createElement("span",null,(0,d.__)("No result","semlinks"))))))},X=wp.i18n.__,Z={bindEvents:function(){var t=document.querySelectorAll(".semlinks-plugin-related-posts-meta-box-action-button");t&&t.forEach((function(t){t.addEventListener("click",Z.handleActionButtonClick)}));var e=document.querySelectorAll("[id^='semlinks-plugin-remove-related-post-button']");e&&e.forEach((function(t){t.addEventListener("click",Z.removeRelatedPost)}))},addSpinner:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.createElement("div");return n.className="spinner semlinks-plugin-spinner",t.after(n),e&&t.parentElement.removeChild(t),n},handleActionButtonClick:function(t){var e=t.target;t.preventDefault();var n=Z.addSpinner(e),r=e.getAttribute("data-ajaxurl"),o={action:e.getAttribute("data-action"),nonce:e.getAttribute("data-nonce"),postId:e.getAttribute("data-postId")};fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"},body:new URLSearchParams(o)}).then((function(t){return t.json()})).then((function(t){if(n.parentNode.removeChild(n),!t.success)throw alert(X("An error occurred.","semlinks")),new Error("Response content : ".concat(t.data));return t.data})).then((function(t){Z.replaceRelatedPostsTableContent(t)})).catch((function(t){alert(X("An error occurred.","semlinks")),console.error(t),n.parentNode.removeChild(n)}))},removeRelatedPost:function(t){var e=t.target;t.preventDefault();var n=Z.addSpinner(e,!0),r=e.getAttribute("data-ajaxurl"),o={action:e.getAttribute("data-action"),nonce:e.getAttribute("data-nonce"),postId:e.getAttribute("data-postId"),relatedPost:e.getAttribute("data-relatedPost")};fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"},body:new URLSearchParams(o)}).then((function(t){return t.json()})).then((function(t){if(n.parentNode.removeChild(n),!t.success)throw n.parentNode.removeChild(n),alert(X("An error occurred.","semlinks")),new Error("Response content : ".concat(t.data));return t.data})).then((function(t){Z.replaceRelatedPostsTableContent(t)})).catch((function(t){alert(X("An error occurred.","semlinks")),console.error(t),n.parentNode.removeChild(n)}))},replaceRelatedPostsTableContent:function(t){document.querySelector("#semlinks-plugin-related-posts-meta-box > .inside").innerHTML=t.metaBoxContent,Z.bindEvents()}},tt=Z;function et(t){return function(t){if(Array.isArray(t))return ot(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||rt(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,_x,i,a=[],_n=!0,c=!1;try{if(_x=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;_n=!1}else for(;!(_n=(r=_x.call(n)).done)&&(a.push(r.value),a.length!==e);_n=!0);}catch(t){c=!0,o=t}finally{try{if(!_n&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return a}}(t,e)||rt(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rt(t,e){if(t){if("string"==typeof t)return ot(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ot(t,e):void 0}}function ot(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var it=function(t){var e=t.currentPost,r=t.pluginSettings,o=nt((0,f.useState)(!1),2),i=o[0],a=o[1],c=nt((0,f.useState)(!0),2),l=c[0],u=c[1],p=nt((0,f.useState)(!1),2),v=p[0],g=p[1],b=nt((0,f.useState)(null),2),w=b[0],E=b[1],_=nt((0,f.useState)(null),2),S=_[0],k=_[1],O=nt((0,f.useState)(!1),2),x=O[0],R=O[1],A=nt((0,f.useState)([]),2),j=A[0],P=A[1],L=nt((0,f.useState)([]),2),T=L[0],C=L[1],I=(0,m.useSelect)((function(t){return t(Q.store).getEditedPostContent("postType",e.type,e.id)}),[]),N=wp.data.select("core/editor").getCurrentPostId(),F=""!==e.excerpt?e.excerpt:e.title,G=e.title,B=(0,m.useSelect)((function(t){return t(Q.store).getEditedPostAttribute("tags")}));(0,h.useEffect)((function(){i&&function(t,e,n,r,o,i,a,c,l){t(!0),e(null);var u=[q.fetchNamedEntities({content:a,matcher:"csp_basic_matcher"}),y({postId:i,content:a,introduction:c,title:l})];Promise.all(u).then((function(e){var i,a=nt(e,2),c=a[0],l=a[1];n(0===c.entities.length&&0===l.posts.length),r((i=c.entities).map((function(t){return t.count=i.filter((function(e){return e.entity===t.entity})).length,t})).filter((function(t,e,n){return n.findIndex((function(e){return e.entity===t.entity}))===e}))),o(l.posts),t(!1)})).catch((function(n){console.error(n),e(n),t(!1)}))}(u,E,g,P,C,N,I,F,G)}),[i]);var D={loading:function(){return React.createElement("div",{style:{textAlign:"center"}},React.createElement("span",{className:"spinner semlinks-plugin-spinner"}))},error:function(){return React.createElement("div",null,(0,d.__)("An error occurred while finding links","semlinks"))},empty:function(){return React.createElement("div",null,(0,d.__)("No links were found","semlinks"))},result:function(){return React.createElement(s.Panel,null,React.createElement(s.PanelBody,{title:(0,d.__)("Related posts","semlinks"),initialOpen:!0},React.createElement(s.PanelRow,null,React.createElement(W,{posts:T,setPosts:C}))),React.createElement(s.PanelBody,{title:(0,d.__)("Known named entities","semlinks"),initialOpen:!0},React.createElement(s.PanelRow,null,React.createElement(J,{entities:j,withAction:!1}))))}};return(0,h.useEffect)((function(){var t="result";w&&(t="error"),l&&(t="loading"),v&&(t="empty"),k(D[t]())}),[S,l,w,v]),(0,h.useEffect)((function(){void 0!==r&&R("true"===r.is_api_key_valid&&r.allowed_features.includes("NER")&&r.allowed_features.includes("LOOKALIKE")&&r.ner_dictionary)}),[r]),React.createElement("div",null,React.createElement("button",{className:"button button-primary semlinks-plugin-meta-box-action-button",onClick:function(t){if(!x)return t.preventDefault(),void alert((0,d.__)("No dictionary is configured, please contact your administrator.","semlinks"));a(!0)}},(0,d.__)("Find links","semlinks")),i&&React.createElement(s.Modal,{title:(0,d.__)("SemLinks","semlinks"),onRequestClose:function(){return a(!1)},style:{minWidth:"90%",paddingBottom:"64px"}},S,React.createElement("div",{style:{position:"fixed",bottom:"10px",right:"10px",backgroundColor:"white"}},React.createElement(s.Button,{style:{marginRight:"1em"},variant:"secondary",onClick:function(){return a(!1)}},(0,d.__)("Cancel","semlinks")),React.createElement(s.Button,{variant:"primary",onClick:function(){var t,o=[q.fetchNamedEntities({content:I,matcher:"csp_basic_matcher"}),(t={postId:N,posts:T.map((function(t){return t.ID}))},n()({path:"/semlinks-plugin/v1/related-posts/save-related-posts",method:"POST",data:t}))];Promise.all(o).then((function(t){var e=nt(t,2),n=e[0],r=e[1];return tt.replaceRelatedPostsTableContent(r),n})).then((function(t){var n=t.entities,o=t.article;r&&!r.ner_only_add_as_tag&&(0,m.dispatch)(Q.store).resetBlocks(wp.blocks.parse(o.text));var i=Object.values(n).map((function(t){return t.id})),c={tags:[].concat(et(B),et(i)).filter((function(t,e,n){return n.indexOf(t)===e}))};(0,m.dispatch)("core").editEntityRecord("postType",e.type,e.id,c),u(!1),a(!1)}))},disabled:l||w},(0,d.__)("Create","semlinks")))))},at=window.wp.editPost;function ct(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,_x,i,a=[],_n=!0,c=!1;try{if(_x=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;_n=!1}else for(;!(_n=(r=_x.call(n)).done)&&(a.push(r.value),a.length!==e);_n=!0);}catch(t){c=!0,o=t}finally{try{if(!_n&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return lt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lt(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ut=function(t){var e=(0,m.useSelect)((function(t){return t(Q.store).getCurrentPostType()}),[]),n=(0,m.useSelect)((function(t){return t(Q.store).getCurrentPost()})),r=ct((0,j.useEntityProp)("postType",e,"meta"),2),o=r[0],a=r[1],c=ct((0,f.useState)(void 0),2),l=c[0],u=c[1],s=ct((0,f.useState)(!1),2),p=s[0],y=s[1],v=ct((0,f.useState)(!1),2),g=v[0],b=v[1];return(0,h.useEffect)((function(){i.getSettings().then((function(t){return u(t)})),i.isApiKeyValid().then((function(t){i.isFeatureAllowed("NER").then((function(e){y(t&&e)}))})),_("semlinks_plugin.semantic_platform.entities").then((function(t){b(t)}))}),[]),React.createElement(React.Fragment,null,!1===g||!1===p&&null,!0===g&&!0===p&&React.createElement(at.PluginDocumentSettingPanel,{title:(0,d.__)("SemLinks","semlinks")},React.createElement(it,{currentPost:n,setMeta:a,meta:o,pluginSettings:l})))},st=wp.plugins.registerPlugin;function ft(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}i.isApiKeyValid().then((function(t){t&&wp.domReady((function(){var t=[];t.push(i.isFeatureAllowed("NER")),t.push(i.isFeatureAllowed("LOOKALIKE")),Promise.all(t).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,_x,i,a=[],_n=!0,c=!1;try{if(_x=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;_n=!1}else for(;!(_n=(r=_x.call(n)).done)&&(a.push(r.value),a.length!==e);_n=!0);}catch(t){c=!0,o=t}finally{try{if(!_n&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return a}}(e,n)||function(t,e){if(t){if("string"==typeof t)return ft(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ft(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1];i&&A(),o&&i&&st("semlinks-plugin-ner",{render:ut})}))}))})),window.addEventListener("load",(function(){l.bindEvents(),tt.bindEvents()}))}();